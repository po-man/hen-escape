const canvas=document.getElementById("game-canvas"),ctx=canvas.getContext("2d"),gameOverScreen=document.getElementById("game-over-screen"),finalScoreElement=document.getElementById("final-score"),restartBtn=document.getElementById("restart-btn"),scrollDialog=document.getElementById("scroll-dialog"),startScreen=document.getElementById("start-screen"),scrollHint=document.getElementById("scroll-hint");let frames=0,score=0,gameSpeed=4,isGameOver=!1,hasScroll=!1,gameStarted=!1;const GRAVITY=.6,JUMP_STRENGTH=12;let groundHeight=50,obstacles=[],spawnTimer=0,scrollItem=null,bgLayer1={x:0,speedMod:.2},bgLayer2={x:0,speedMod:.5};const hen={x:0,y:0,width:40,height:40,dy:0,grounded:!1,color:"#D35400",draw:function(){ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.width,this.height),ctx.fillStyle="#F1C40F",ctx.fillRect(this.x+30,this.y+10,15,10),ctx.fillStyle="#000",ctx.fillRect(this.x+25,this.y+5,5,5),ctx.fillStyle="#A04000",ctx.fillRect(this.x+10,this.y+20,20,10)},update:function(){this.dy+=.6,this.y+=this.dy,this.y+this.height>canvas.height-groundHeight?(this.y=canvas.height-groundHeight-this.height,this.dy=0,this.grounded=!0):this.grounded=!1},jump:function(){this.grounded&&(this.dy=-12,this.grounded=!1)}};function startGame(e){e&&(e.stopPropagation(),e.preventDefault()),gameStarted=!0,startScreen.classList.add("hidden")}function handleInput(){gameStarted&&(isGameOver||hen.jump())}function spawnObstacle(){obstacles.push({x:canvas.width,y:canvas.height-groundHeight-40,width:40,height:40,markedForDeletion:!1})}function handleObstacles(){spawnTimer--,spawnTimer<=0&&(spawnObstacle(),spawnTimer=60+90*Math.random());for(let e=0;e<obstacles.length;e++){let t=obstacles[e];t.x-=gameSpeed,hen.x<t.x+t.width&&hen.x+hen.width>t.x&&hen.y<t.y+t.height&&hen.y+hen.height>t.y&&gameOver(),t.x+t.width<0&&(t.markedForDeletion=!0,score++)}obstacles=obstacles.filter((e=>!e.markedForDeletion))}function updateScroll(){score>=6&&!hasScroll&&!scrollItem&&Math.random()<.005&&(scrollItem={x:canvas.width,y:canvas.height-groundHeight-30,width:30,height:30}),scrollItem&&(scrollItem.x-=gameSpeed,hen.x<scrollItem.x+scrollItem.width&&hen.x+hen.width>scrollItem.x&&hen.y<scrollItem.y+scrollItem.height&&hen.y+hen.height>scrollItem.y?(hasScroll=!0,scrollItem=null):scrollItem.x+scrollItem.width<0&&(scrollItem=null))}function drawBackground(){gameStarted&&!isGameOver&&(bgLayer1.x-=gameSpeed*bgLayer1.speedMod,bgLayer1.x<=-canvas.width&&(bgLayer1.x=0),bgLayer2.x-=gameSpeed*bgLayer2.speedMod,bgLayer2.x<=-canvas.width&&(bgLayer2.x=0)),drawFarLayer(bgLayer1.x),drawFarLayer(bgLayer1.x+canvas.width),drawMidLayer(bgLayer2.x),drawMidLayer(bgLayer2.x+canvas.width)}function drawFarLayer(e){ctx.fillStyle="#1a1a1a",ctx.fillRect(e,0,canvas.width,canvas.height),ctx.fillStyle="#262626";for(let t=0;t<canvas.width;t+=25)for(let a=0;a<canvas.height;a+=25)ctx.fillRect(e+t,a,20,20)}function drawMidLayer(e){let t=80;for(let a=0;a<canvas.height-groundHeight;a+=t){ctx.fillStyle="#4a4a4a",ctx.fillRect(e,a+t-10,canvas.width,10),ctx.fillStyle="#3d3d3d",ctx.fillRect(e,a+t-20,canvas.width,5),ctx.fillStyle="#4d1f01";for(let l=0;l<canvas.width;l+=40)ctx.fillRect(e+l+5,a+t-35,30,20),ctx.fillStyle="#5e4c05",ctx.fillRect(e+l+32,a+t-30,5,5),ctx.fillStyle="#4d1f01";ctx.strokeStyle="#333",ctx.lineWidth=2;for(let l=0;l<canvas.width;l+=10)l%60==0?(ctx.fillStyle="#2c3e50",ctx.fillRect(e+l,a,10,t)):(ctx.beginPath(),ctx.moveTo(e+l,a),ctx.lineTo(e+l,a+t-20),ctx.stroke())}}function drawScroll(){scrollItem&&(ctx.fillStyle="#FFD700",ctx.fillRect(scrollItem.x,scrollItem.y,scrollItem.width,scrollItem.height),ctx.fillStyle="#000",ctx.font="20px Courier",ctx.textAlign="left",ctx.fillText("?",scrollItem.x+8,scrollItem.y+22))}function drawObstacles(){for(let e=0;e<obstacles.length;e++){let t=obstacles[e];ctx.fillStyle="#95a5a6",ctx.fillRect(t.x,t.y,t.width,t.height),ctx.strokeStyle="#2c3e50",ctx.lineWidth=2,ctx.strokeRect(t.x,t.y,t.width,t.height),ctx.beginPath(),ctx.moveTo(t.x+13,t.y),ctx.lineTo(t.x+13,t.y+t.height),ctx.moveTo(t.x+26,t.y),ctx.lineTo(t.x+26,t.y+t.height),ctx.stroke()}}function drawUI(){gameStarted&&(ctx.fillStyle="rgba(255, 255, 255, 0.8)",ctx.font="16px Courier",ctx.textAlign="left",ctx.fillText(`å¾—åˆ†: ${score}`,10,30),ctx.textAlign="right",ctx.fillText(`é€Ÿåº¦: ${gameSpeed.toFixed(1)}`,canvas.width-10,30),hasScroll&&(ctx.font="24px serif",ctx.textAlign="right",ctx.fillText("ðŸ“œ",canvas.width-140,30)),ctx.textAlign="left")}function gameOver(){isGameOver=!0,finalScoreElement.innerText="å¾—åˆ†: "+score,hasScroll?(scrollDialog.classList.remove("hidden"),scrollHint.classList.add("hidden")):(scrollDialog.classList.add("hidden"),scrollHint.classList.remove("hidden")),gameOverScreen.classList.remove("hidden")}function resetGame(){hen.y=canvas.height-groundHeight-hen.height,hen.dy=0,obstacles=[],spawnTimer=0,frames=0,score=0,gameSpeed=4,isGameOver=!1,hasScroll=!1,scrollItem=null,scrollDialog.classList.add("hidden"),scrollHint.classList.add("hidden"),gameOverScreen.classList.add("hidden"),gameStarted=!0,bgLayer1.x=0,bgLayer2.x=0,gameLoop()}function update(){gameStarted&&(frames++,hen.update(),handleObstacles(),updateScroll(),frames%240==0&&(gameSpeed+=.5))}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height),drawBackground(),ctx.fillStyle="#222",ctx.fillRect(0,canvas.height-groundHeight,canvas.width,groundHeight),ctx.strokeStyle="#555",ctx.beginPath(),ctx.moveTo(0,canvas.height-groundHeight),ctx.lineTo(canvas.width,canvas.height-groundHeight),ctx.stroke(),drawObstacles(),drawScroll(),hen.draw(),drawUI()}function gameLoop(){isGameOver||(update(),draw(),requestAnimationFrame(gameLoop))}function resize(){canvas.width=canvas.parentElement.clientWidth,canvas.height=canvas.parentElement.clientHeight,groundHeight=canvas.height>canvas.width?canvas.height/3:50,hen.x=canvas.width/2-hen.width/2,hen.y=canvas.height-groundHeight-hen.height,obstacles.forEach((e=>{e.y=canvas.height-groundHeight-e.height})),scrollItem&&(scrollItem.y=canvas.height-groundHeight-scrollItem.height)}startScreen.addEventListener("mousedown",startGame),startScreen.addEventListener("touchstart",startGame),document.addEventListener("keydown",(e=>{"Space"===e.code&&(gameStarted?handleInput():startGame())})),document.addEventListener("touchstart",(e=>{"restart-btn"===e.target.id||e.target.closest(".scroll-btn")||gameStarted&&(e.cancelable&&e.preventDefault(),handleInput())}),{passive:!1}),document.addEventListener("mousedown",(()=>{gameStarted&&handleInput()})),document.addEventListener("touchmove",(e=>{e.target.closest(".scroll-btn")||e.target.closest(".scroll-paper")||e.preventDefault()}),{passive:!1}),restartBtn.addEventListener("click",(e=>{e.stopPropagation(),resetGame()})),window.addEventListener("resize",resize),resize(),gameLoop();